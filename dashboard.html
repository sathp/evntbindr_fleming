<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>evntbindr. | The world's party planner</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
      <link rel='stylesheet' type='text/css' href='http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css'/>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    <style rel="stylesheet">
    /* TEMPLATE STYLES */
    
    .avatar {
        border-radius: 50%;
        width: 120px;
        height: auto;
        margin: -65px auto 0;
        border: 5px solid #fff;
        background: #FFF;
    }
    
    .avatar img {
        width: 100%;
    }
    
    .file_input_div {
        margin: auto;
        width: 250px;
        height: 40px;
    }
    /*    .file_input {
        float: left;
    }*/
    /*    #file_input_text_div {
        width: 50%;
        margin-top: -8px;
        margin-left: 5px;
    }*/
    
    .none {
        display: none;
    }
    </style>

</head>

<body>
    <!--Navigation & Intro-->
    <header>
        <!--Navbar-->
        <nav class="navbar navbar-toggleable-md navbar-dark ">
            <div class="container">
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav1" aria-controls="navbarNav1" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="#">
                    <strong>evntbindr.</strong>
                </a>
                <ul class="nav navbar-nav ml-auto nav-flex-icons">
                    <li class="nav-item log_in">
                        <a class="nav-link" href="#!" id="login_with_google">log in  <i class="fa fa-google"></i></a>
                    </li>
                    <li class="nav-item dropdown btn-group">
                        <a id="user_name" class="nav-link dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">user</a>
                        <div class="dropdown-menu dropdown" aria-labelledby="dropdownMenu1">
                            <a class="dropdown-item"><i class="fa fa-dashboard" aria-hidden="true"></i> Dashboard</a>
                            <a class="dropdown-item" id="logout" href="index.html"><i class="fa fa-sign-out" aria-hidden="true"></i> Log Out</a>
                        </div>
                    </li>
                </ul>
            </div>
            </div>
        </nav>
        <!--/.Navbar-->
    </header>
    <!--/Navigation & Intro-->
    <!--Main layout-->
    <div class="container">
        <div class="divider-new">
            <h2 class="h2-responsive wow fadeIn" data-wow-delay="0.2s"><i class="fa fa-dashboard" aria-hidden="true"></i>  Dashboard</h2>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <!--Sidebar-->
            <div class="col-lg-3 col-md-3 wow fadeIn" data-wow-delay="0.2s">
                <div class="widget-wrapper wow fadeIn" data-wow-delay="0.4s">
                    <div class="card">
                        <div class="avatar">
                            <img id="user_img" src="http://via.placeholder.com/64x64" class="img-fluid rounded-circle z-depth-1">
                        </div>
                        <div class="container">
                            <h4><span id="dash_name">Full Name</span></h4>
                            <p class="title"><span id="user_email">e-mail id</span>
                                <br><span id="user_phone">phone number</span></p>
                            <div style="margin: 24px 0;">
                            </div>
                        </div>
                        <div class="list-group">
                            <a href="#" class="list-group-item active">Dashboard</a>
                            <a class="list-group-item">
                                <p>Messages <span class="badge grey">Coming Soon</span></p>
                            </a>
                        </div>
                    </div>
                </div>
                <br>
                <div class="card z-index-2">
                    <div class="container papaya" style="padding:15px;text-align: center;">
                        <h4><span id="user_views">xxxxxx</span></h4>
                        <p class="title" style="color: #ffffff;"><strong>people are interested in your venue this week</strong></p>
                    </div>
                </div>
            </div>
            <!--/.Sidebar-->
            <div class="col-md-9">
                <h5>YOUR VENUES</h5>
                <div class="row" id="venues">
                    <div class="col-lg-6">
                        <!--Card-->
                        <div class="card">
                            <!--Card image-->
                            <div class="hm-white-slight">
                                <img src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20%287%29.jpg" class="img-fluid" alt="">
                            </div>
                            <!--/.Card image-->
                            <!--Card content-->
                            <div class="card-block">
                                <!--Title-->
                                <h4 class="card-title"><span id="venue_name">Venue Name</span></h4><a href="#" class="btn btn-primary"><i class="fa fa-pencil left"></i> EDIT</a>
                            </div>
                            <!--/.Card content-->
                        </div>
                        <!--/.Card-->
                    </div>
                    <div class="col-lg-6">
                        <!--Card-->
                        <div class="card">
                            <!--Card image-->
                            <div class="hm-white-slight">
                                <img src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20%287%29.jpg" class="img-fluid" alt="">
                            </div>
                            <!--/.Card image-->
                            <!--Card content-->
                            <div class="card-block">
                                <!--Title-->
                                <h4 class="card-title"><span id="venue_name">Venue Name</span></h4><a href="#" class="btn btn-primary"><i class="fa fa-pencil left"></i> EDIT</a>
                            </div>
                            <!--/.Card content-->
                        </div>
                        <!--/.Card-->
                    </div>
                </div>
                <!--Registration Form and FAB-->
                <a class="btn btn-large btn-primary z-depth-2" style="height: 70px; width:70px;border-radius: 60%; position: fixed; bottom: 15px; right: 15px;" onclick="show('reg_form')"><i class="fa fa-plus fa-lg flex-center"></i></a>
                <!--Form_Card-->
                <form>
                    <div class="card z-depth-2" style="position: fixed; z-index: 1000; top: 30px; display: none; overflow-y: scroll; height: 90vh; width: 50vw;" id="reg_form">
                        <div class="card-block">
                            <h4 class="card-title flex-center">Register your venue</h4>
                            <hr>
                            <a href="" style="position: absolute; top: 10px; right: 10px;" onclick="hide('reg_form')"><i class="fa fa-close aqua-i"></i></a>
                            <!--Body-->
                            <div class="md-form">
                                <i class="fa fa-building prefix aqua-i"></i>
                                <input type="text" id="name" class="form-control" placeholder="Name of the Venue" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-info prefix"></i>
                                <input type="text" id="description" class="form-control" placeholder="Description" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-map-marker prefix"></i>
                                <input type="text" id="location" class="form-control" placeholder="Location" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-home prefix"></i>
                                <input type="text" id="venue_type" class="form-control" placeholder="Type (e.g banquet hall/restaurants etc)" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-sun-o prefix"></i>
                                <input type="text" id="setting" class="form-control" placeholder="Indoor/Outdoor" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-group prefix"></i>
                                <input type="text" id="capacity" class="form-control" placeholder="Capacity" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-inr prefix"></i>
                                <input type="text" id="price" class="form-control" placeholder="Price" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-wifi prefix"></i>
                                <input type="text" id="amenities" class="form-control" placeholder="Amenities" style="color:black;">
                            </div>
                            <div class="md-form">
                                <i class="fa fa-warning prefix"></i>
                                <input type="text" id="rules" class="form-control" placeholder="Rules (if any)" style="color:black;">
                            </div>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="md-form file_input">
                                        <label class="image_input_button mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-js-ripple-effect mdl-button--colored">
                                            <a class="btn btn-primary"> Upload an Image</a>
                                            <input id="mediaCapture" class="none" type="file" />
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div id="file_input_text_div" class="mdl-textfield mdl-js-textfield textfield-demo">
                                        <input class="file_input_text mdl-textfield__input" type="text" disabled readonly id="file_input_text" />
                                        <label class="mdl-textfield__label" for="file_input_text"></label>
                                    </div>
                                </div>
                            </div>
                            <p>
                            <div class="text-center">
                                <button class="btn btn-deep-purple" id="submit" onclick="venue_function()"> Submit </button>
                            </div>
                        </div>
                    </div>
                </form>
                <!--/.Panel-->
            </div>
        </div>
    </div>
    <!--/.Main layout-->
    </main>
    <!--Footer-->
    <footer class="page-footer center-on-small-only nopadding">
        <!--Footer Links-->
        <div class="container-fluid">
            <div class="row">
                <!--First column-->
                <div class="col-lg-3 offset-lg-1 hidden-lg-down">
                    <h5 class="title">About evntbindr.</h5>
                    <p>EVNTBINDR is an online platform meant to make event planning easy. </p>
                </div>
                <!--/.First column-->
                <hr class="hidden-md-up">
                <!--Second column-->
                <div class="col-lg-6 col-md-9">
                  <h5 class="title">CONNECT WITH US</h5>
                  <ul>
                  <li><a href="https://www.facebook.com/evntbindr/"><i class="fa fa-facebook" aria-hidden="true"></i> Facebook </li> </a>
                  <li><a href="https://www.instagram.com/evntbindr/"><i class="fa fa-instagram" aria-hidden="true"></i> Instagram </li></a>
                </div>
            </div>
        </div>
        <!--/.Footer Links-->
        <!--Copyright-->
        <div class="footer-copyright">
            <div class="container-fluid">
                © 2017 Copyright: <a href="http://www.github.com/sathp/evntbindr_fleming"> evntbindr.</a> Developed with <span class="glyphicon glyphicon-heart">love</span> by <a href="http://www.ahamlearning.com">Team Fleming at Techpreneurship Bootcamp, Aham Learning Hub</a>.
            </div>
        </div>
        <!--/.Copyright-->
    </footer>
    <!--/.Footer-->
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="js/jquery-2.2.3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/tether.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <script>
    new WOW().init();
    </script>
    <script type="text/javascript">
    function show(target) {
        document.getElementById(target).style.display = 'block';
    }

    function hide(target) {
        document.getElementById(target).style.display = 'none';
    }
    </script>
    <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
    <script>
    // Initialize Firebase
     var config = {
    apiKey: "AIzaSyAnTgoI54Z-LiR94TUDmu3ejDyrP0M_u-k",
    authDomain: "evntbindr-a5d5e.firebaseapp.com",
    databaseURL: "https://evntbindr-a5d5e.firebaseio.com",
    projectId: "evntbindr-a5d5e",
    storageBucket: "evntbindr-a5d5e.appspot.com",
    messagingSenderId: "111766807795"
  };
  firebase.initializeApp(config);


  var database = firebase.database();
  var venuesRef = database.ref('venues');
  var usersRef = database.ref('users');
 
  var storage = firebase.storage();

  var storageRef = firebase.storage().ref();
  var u;

    var provider = new firebase.auth.GoogleAuthProvider();

    $('#login_with_google').click(function() {
        firebase.auth().signInWithPopup(provider).then(function(result) {
            // This gives you a Google Access Token. You can use it to access the Google API.
            var token = result.credential.accessToken;
            // The signed-in user info.
            var user = result.user;
            // ...
        }).catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            // ...
        });
    });

    $('#logout').click(function() {
        firebase.auth().signOut().then(function() {
            // Sign-out successful.
        }).catch(function(error) {
            // An error happened.
        });
    });

    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            u = user
            // User is signed in.
            // 1. Logged In - Show Logout
            console.log("User is Logged In");
            //console.log(user);
            //console.log("Email:", user.email, user.displayName, user.photoURL);

            $('#user_name').show();
            $('#user_name').html(user.displayName);
            $('#dash_name').html(user.displayName);
            $('#user_img').attr('src', user.photoURL);
            $('#user_email').html(user.email);
            $('#login_with_google').hide();

            usersRef.once("value").then(function(snapshot) {
                snapshot.forEach(function(post) {
                    if(u.uid === post.val().uid) {
                        $("#venues").append('<div class="col-lg-6">' +
                        '<div class="card">' +
                            '<div class="hm-white-slight">' +
                                '<img src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20%287%29.jpg" class="img-fluid" alt="">' +
                            '</div>' +
                            '<div class="card-block">' +
                                '<h4 class="card-title"><span id="venue_name">Venue Name</span></h4><a href="#" class="btn btn-primary"><i class="fa fa-pencil left"></i> EDIT</a>' +
                            '</div>' +
                        '</div>' +
                    '</div>');
                    }
                });
            });
            // ...
        } else {
            // User is signed out.
            // 2. Logged Out/ Not Logged In - Show "Login with Google"
            console.log("User is not logged in");
            $('#user_name').hide();
            $('#login_with_google').show();
            // ...
        }

    })
    </script>
    <script>
       
        function venue_function(){
          
           var venuedata = {
            userName: firebase.auth().currentUser.displayName,
            uid: firebase.auth().currentUser.uid,
            name : $('#name').val(),
            description : $('#description').val(),
            owner : $('#owner').val(),
            location : $('#location').val(),
            venue_type : $('#venue_type').val(),
            setting : $('#setting').val(),
            capacity: $('#capacity').val(),
            price : $('#price').val(),
            amenities : $('#amenities').val(),
            rules : $('#rules').val(),
           

        };
 
        var userdata = {
            userName: firebase.auth().currentUser.displayName,
            
            uid: firebase.auth().currentUser.uid,
            name : $('#name').val()
        };
        
       /* var newPostKey = firebase.database().ref().child('venues').push().key;
        var updates = {};
        updates['/venues/' + newPostKey] = venuedata;
        updates['/users/' + uid + '/' + newPostKey] = venuedata;
        firebase.database().ref().update(updates);*/
        
/*    var firebaseref = firebase.database().ref()  
    
    firebaseref.child(33).push(venuedata);
    rt
    }*/
    var newPostKey = firebase.database().ref().child('posts').push().key;

  // Write the new post's data simultaneously in the posts list and the user's post list.t
  console.log($("#mediaCapture").prop("files")[0]);
  var file = $("#mediaCapture").prop("files")[0];
  console.log(newPostKey + "." + file.name.split('.').pop());

  storageRef.child(newPostKey + "." + file.name.split('.').pop()).put(file).then(function(snapshot) {
        console.log(snapshot);
      var updates = {};
      venuedata["key"] = newPostKey;
       updates['/venues/' + newPostKey] = venuedata;
       updates['/users/' + u.uid] = venuedata;
    /*  updates {newPostKey] = venuedata;*/

      firebase.database().ref().update(updates);
  })
  return false;
}
    </script>
    <script type="text/javascript">
    var fileInputTextDiv = document.getElementById('file_input_text_div');
    var fileInput = document.getElementById('file_input_file');
    var fileInputText = document.getElementById('file_input_text');

    fileInput.addEventListener('change', changeInputText);
    fileInput.addEventListener('change', changeState);

    function changeInputText() {
        var str = fileInput.value;
        var i;
        if (str.lastIndexOf('\\')) {
            i = str.lastIndexOf('\\') + 1;
        } else if (str.lastIndexOf('/')) {
            i = str.lastIndexOf('/') + 1;
        }
        fileInputText.value = str.slice(i, str.length);
    }

    function changeState() {
        if (fileInputText.value.length != 0) {
            if (!fileInputTextDiv.classList.contains("is-focused")) {
                fileInputTextDiv.classList.add('is-focused');
            }
        } else {
            if (fileInputTextDiv.classList.contains("is-focused")) {
                fileInputTextDiv.classList.remove('is-focused');
            }
        }
    }
    </script>
</body>

</html>
