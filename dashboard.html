<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>evntbindr. | The world's party planner</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <style rel="stylesheet">
    /* TEMPLATE STYLES */
    
    .avatar {
        border-radius: 50%;
        width: 120px;
        height: auto;
        margin: -65px auto 0;
        border: 5px solid #fff;
        background: #FFF;
    }
    
    .avatar img {
        width: 100%;
    }
    </style>
</head>

<body>
    <!--Navigation & Intro-->
    <header>
        <!--Navbar-->
        <nav class="navbar navbar-toggleable-md navbar-dark ">
            <div class="container">
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav1" aria-controls="navbarNav1" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="#">
                    <strong>evntbindr.</strong>
                </a>
                <ul class="nav navbar-nav ml-auto nav-flex-icons">
                    <li class="nav-item log_in">
                        <a class="nav-link" href="#!" id="login_with_google">Log in / Sign up  <i class="fa fa-google"></i></a></a>
                    </li>
                    <li class="nav-item dropdown btn-group">
                        <a id="user_name" class="nav-link dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">user</a>
                        <div class="dropdown-menu dropdown" aria-labelledby="dropdownMenu1">
                            <a class="dropdown-item" href="index.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
                            <a class="dropdown-item" id="logout"><i class="fa fa-sign-out" aria-hidden="true"></i> Log Out</a>
                        </div>
                    </li>
                </ul>
            </div>
            </div>
        </nav>
        <!--/.Navbar-->
    </header>
    <!--/Navigation & Intro-->
    <!--Main layout-->
    <div class="container">
        <div class="divider-new">
            <h2 class="h2-responsive wow fadeIn" data-wow-delay="0.2s"><i class="fa fa-dashboard" aria-hidden="true"></i>  Dashboard</h2>
        </div>
        <div class="row" style="margin-bottom: 10px;">
            <!--Sidebar-->
            <div class="col-lg-3 col-md-3 wow fadeIn" data-wow-delay="0.2s">
                <div class="widget-wrapper wow fadeIn" data-wow-delay="0.4s">
                    <div class="card">
                        <div class="avatar">
                            <img id="user_img" src="http://via.placeholder.com/64x64" class="img-fluid rounded-circle z-depth-1">
                        </div>
                        <div class="container">
                            <h4><span id="dash_name">Full Name</span></h4>
                            <p class="title"><span id="user_email">e-mail id</span>
                                <br><span id="user_phone">phone number</span></p>
                            <div style="margin: 24px 0;">
                            </div>
                        </div>
                        <div class="list-group">
                            <a href="#" class="list-group-item active">Dashboard</a>
                            <a class="list-group-item">
                                <p>Messages <span class="badge grey">Coming Soon</span></p>
                            </a>
                        </div>
                    </div>
                </div>
                <br>
                <div class="card z-index-2">
                    <div class="container papaya" style="padding:15px;text-align: center;">
                        <h4><span id="user_views">xxxxxx</span></h4>
                        <p class="title" style="color: #ffffff;"><strong>people are interested in your venue this week</strong></p>
                    </div>
                </div>
            </div>
            <!--/.Sidebar-->
            <div class="col-md-9">
                <h5>YOUR VENUES</h5> <a class="btn btn-large btn-primary" style="height: 70px; width:70px;border-radius: 60%; position: fixed; bottom: 15px; right: 15px;"><i class="fa fa-plus fa-lg flex-center"></i></a>
                <div class="row">
                    <div class="col-lg-6">
                        <!--Card-->
                        <div class="card">
                            <!--Card image-->
                            <div class="hm-white-slight">
                                <img src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20%287%29.jpg" class="img-fluid" alt="">
                            </div>
                            <!--/.Card image-->
                            <!--Card content-->
                            <div class="card-block">
                                <!--Title-->
                                <h4 class="card-title"><span id="venue_name">Venue Name</span></h4><a href="#" class="btn btn-primary"><i class="fa fa-pencil left"></i> EDIT</a>
                            </div>
                            <!--/.Card content-->
                        </div>
                        <!--/.Card-->
                    </div>
                                        <div class="col-lg-6">
                        <!--Card-->
                        <div class="card">
                            <!--Card image-->
                            <div class="hm-white-slight">
                                <img src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20%287%29.jpg" class="img-fluid" alt="">
                            </div>
                            <!--/.Card image-->
                            <!--Card content-->
                            <div class="card-block">
                                <!--Title-->
                                <h4 class="card-title"><span id="venue_name">Venue Name</span></h4><a href="#" class="btn btn-primary"><i class="fa fa-pencil left"></i> EDIT</a>
                            </div>
                            <!--/.Card content-->
                        </div>
                        <!--/.Card-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form id="submit-form">
        <div style="width:50%; margin: 0 auto; display: block;">
            <div class="card">
                <div class="card-block" style="color:black;">
                    <!--Header-->
                    <center>
                        <div class="form-header  blue darken-4" style="width:50%;">
                            <h3><i class="fa fa-building"></i> Add a venue</h3>
                        </div>
                    </center>
                    <!--Body-->
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="name" class="form-control" placeholder="Name of the Venue" style="color:black;">
                    </div>
                    <div class="file-field">
                        <div class="row card_">
                            <div class="col-md-3">
                                <div class="btn btn-primary btn-sm" style="width:20%;">
                                    <span></span>
                                    <input type="file" id="mediaCapture" multiple>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="file-path-wrapper">
                                    <input class="file-path validate" type="text" placeholder="Upload one or more files">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="description" class="form-control" placeholder="Description" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="owner" class="form-control" placeholder="Name of the Owner" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="location" class="form-control" placeholder="Location" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="venue_type" class="form-control" placeholder="Type (e.g banquet hall/restaurants etc)" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="setting" class="form-control" placeholder="Indoor/Outdoor" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="capacity" class="form-control" placeholder="Capacity" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="price" class="form-control" placeholder="Price" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="amenities" class="form-control" placeholder="Amenities" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="rules" class="form-control" placeholder="Rules (if any)" style="color:black;">
                    </div>
                    <div class="md-form">
                        <i class="fa fa-envelope prefix"></i>
                        <input type="text" id="available" class="form-control" placeholder="Availability" style="color:black;">
                    </div>
                    <div class="text-center">
                        <button id="submit" class="btn btn-deep-purple">Login</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <!--/.Main layout-->
    </main>
    <!--Footer-->
    <footer class="page-footer center-on-small-only nopadding">
        <!--Footer Links-->
        <div class="container-fluid">
            <div class="row">
                <!--First column-->
                <div class="col-lg-3 offset-lg-1 hidden-lg-down">
                    <h5 class="title">About evntbindr.</h5>
                    <p>Material Design (codenamed Quantum Paper) is a design language developed by Google. </p>
                </div>
                <!--/.First column-->
                <hr class="hidden-md-up">
                <!--Second column-->
                <div class="col-lg-2 col-md-4 offset-lg-1">
                    <h5 class="title"><strong>First column</strong></h5>
                    <ul>
                        <li>
                            <h6><a href="#!">Link 1</a></li></h6>
                            <li>
                                <h6><a href="#!">Link 2</a></li></h6>
                                <li>
                                    <h6><a href="#!">Link 3</a></li></h6>
                                    <li>
                                        <h6><a href="#!">Link 4</a></li></h6>
                    </ul>
                </div>
                <!--/.Second column-->
                <hr class="hidden-md-up">
                <!--Third column-->
                <div class="col-lg-2 col-md-4">
                    <h5 class="title"><strong>Second column</strong></h5>
                    <ul>
                        <li>
                            <h6><a href="#!">Link 1</a></li></h6>
                            <li>
                                <h6><a href="#!">Link 2</a></li></h6>
                                <li>
                                    <h6><a href="#!">Link 3</a></li></h6>
                                    <li>
                                        <h6><a href="#!">Link 4</a></li></h6>
                    </ul>
                </div>
                <!--/.Third column-->
                <hr class="hidden-md-up">
                <!--Fourth column-->
                <div class="col-lg-2 col-md-4">
                    <h5 class="title"><strong>Third column</strong></h5>
                    <ul>
                        <li>
                            <h6><a href="#!">Link 1</a></li></h6>
                            <li>
                                <h6><a href="#!">Link 2</a></li></h6>
                                <li>
                                    <h6><a href="#!">Link 3</a></li></h6>
                                    <li>
                                        <h6><a href="#!">Link 4</a></li></h6>
                    </ul>
                </div>
                <!--/.Fourth column-->
            </div>
        </div>
        <!--/.Footer Links-->
        <!--Copyright-->
        <div class="footer-copyright">
            <div class="container-fluid">
                Â© 2017 Copyright: <a href="http://www.github.com/sathp/evntbindr_fleming"> evntbindr.</a> Developed with <span class="glyphicon glyphicon-heart">love</span> by <a href="http://www.ahamlearning.com">Dhinchak Pooja Fan Association</a>.
            </div>
        </div>
        <!--/.Copyright-->
    </footer>
    <!--/.Footer-->
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="js/jquery-2.2.3.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/tether.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <script>
    new WOW().init();
    </script>
    <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyAnTgoI54Z-LiR94TUDmu3ejDyrP0M_u-k",
        authDomain: "evntbindr-a5d5e.firebaseapp.com",
        databaseURL: "https://evntbindr-a5d5e.firebaseio.com",
        projectId: "evntbindr-a5d5e",
        storageBucket: "evntbindr-a5d5e.appspot.com",
        messagingSenderId: "111766807795"
    };
    firebase.initializeApp(config);

    var provider = new firebase.auth.GoogleAuthProvider();

    $('#login_with_google').click(function() {
        firebase.auth().signInWithPopup(provider).then(function(result) {
            // This gives you a Google Access Token. You can use it to access the Google API.
            var token = result.credential.accessToken;
            // The signed-in user info.
            var user = result.user;
            // ...
        }).catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            // ...
        });
    });

    $('#logout').click(function() {
        firebase.auth().signOut().then(function() {
            // Sign-out successful.
        }).catch(function(error) {
            // An error happened.
        });
    });

    firebase.auth().onAuthStateChanged(function(user) {

        if (user) {
            // User is signed in.
            // 1. Logged In - Show Logout
            console.log("User is Logged In");
            console.log(user);
            console.log("Email:", user.email, user.displayName, user.photoURL);

            $('#user_name').show();
            $('#user_name').html(user.displayName);
            $('#dash_name').html(user.displayName);
            $('#user_img').attr('src', user.photoURL);
            $('#user_email').html(user.email);
            $('#login_with_google').hide();

            // ...
        } else {
            // User is signed out.
            // 2. Logged Out/ Not Logged In - Show "Login with Google"
            console.log("User is not logged in");
            $('#user_name').hide();
            $('#login_with_google').show();
            // ...
        }

    });
    </script>
    <script type="text/javascript">
    var file = false;

    /*
  
      1. We have to upload the picture to storage

      2. We have to create this post

    */

    $('#mediaCapture').on('change', function(event) {

        // console.log("User uploaded a file", event.target.files[0]);

        file = event.target.files[0];

        //    var d = new Date;

        //    var filePath = firebase.auth().currentUser.uid +'-' + d.getTime() + '/' + file.name;

        //    console.log(filePath);

        // storage.ref(filePath).put(file).then(function(snapshot) {
        //  console.log('Uploaded a file',snapshot.metadata.downloadURLs[0]);
        // });

    });

    $('#login_with_google').click(function() {
        firebase.auth().signInWithRedirect(provider).then(function(result) {
            // This gives you a Google Access Token. You can use it to access the Google API.
            var token = result.credential.accessToken;
            // The signed-in user info.
            var user = result.user;
            // ...
        }).catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            // ...
        });
    });

    $('#logout').click(function() {
        firebase.auth().signOut().then(function() {
            // Sign-out successful.
        }).catch(function(error) {
            // An error happened.
        });
    });

    $('#submit-form').on('submit', function(event) {

        console.log("Function Started")

        event.preventDefault(); // Stop default functionality

        var d = new Date;

        var filePath = firebase.auth().currentUser.uid + '-' + d.getTime() + '/' + file.name;

        storage.ref(filePath).put(file).then(function(snapshot) {
            console.log('Uploaded a file', snapshot.metadata.downloadURLs[0]);

            var newPostKey = postRef.child('posts').push().key;

            var postData = {

                uid: firebase.auth().currentUser.uid,
                userName: firebase.auth().currentUser.displayName,
                photoUrl: firebase.auth().currentUser.photoURL,
                name: $('#name').val(),
                description: $('#description').val(),
                owner: $('#owner').val(),
                location: $('#location').val(),
                venue_type: $('#venue_type').val(),
                setting: $('#setting').val(),
                capacity: $('#capacity').val(),
                price: $('#price').val(),
                amenities: $('#amenities').val(),
                rules: $('#rules').val(),
                available: $('#available').val(),
                image: snapshot.metadata.downloadURLs[0],
                timestamp: d.getTime(),
                timestampN: -1 * d.getTime()

            };

            console.log(postData);

            var updates = {};
            updates['/posts/' + newPostKey] = postData;
            firebase.database().ref().update(updates);

        });



    });
    </script>
</body>

</html>
